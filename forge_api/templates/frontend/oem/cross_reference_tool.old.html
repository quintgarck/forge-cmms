{% extends 'frontend/base.html' %}\n{% load static %}\n\n{% block title %}Herramienta de Referencias Cruzadas - MovIAx{% endblock %}\n\n{% block extra_css %}\n<style>\n    .search-tool {\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        color: white;\n        border-radius: 0.5rem;\n        padding: 2rem;\n        margin-bottom: 2rem;\n    }\n    .search-card {\n        background: rgba(255, 255, 255, 0.1);\n        border: 1px solid rgba(255, 255, 255, 0.2);\n        border-radius: 0.5rem;\n        padding: 1.5rem;\n        backdrop-filter: blur(10px);\n    }\n    .result-card {\n        transition: all 0.3s ease;\n        border: 1px solid #e0e0e0;\n        border-radius: 0.5rem;\n        margin-bottom: 1rem;\n        overflow: hidden;\n    }\n    .result-card:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        border-color: #007bff;\n    }\n    .oem-result {\n        border-left: 4px solid #28a745;\n    }\n    .aftermarket-result {\n        border-left: 4px solid #17a2b8;\n    }\n    .confidence-meter {\n        width: 100%;\n        height: 8px;\n        background: #e9ecef;\n        border-radius: 4px;\n        overflow: hidden;\n    }\n    .confidence-fill {\n        height: 100%;\n        transition: width 0.5s ease;\n    }\n    .part-number-display {\n        font-family: 'Courier New', monospace;\n        font-size: 1.1rem;\n        font-weight: bold;\n        background: #f8f9fa;\n        padding: 0.5rem;\n        border-radius: 0.25rem;\n        border: 1px solid #dee2e6;\n    }\n    .search-type-toggle {\n        background: rgba(255, 255, 255, 0.2);\n        border-radius: 2rem;\n        padding: 0.25rem;\n        display: inline-flex;\n    }\n    .search-type-btn {\n        background: transparent;\n        border: none;\n        color: white;\n        padding: 0.5rem 1rem;\n        border-radius: 1.5rem;\n        transition: all 0.3s ease;\n        cursor: pointer;\n    }\n    .search-type-btn.active {\n        background: white;\n        color: #667eea;\n        font-weight: 600;\n    }\n    .popular-parts {\n        background: #f8f9fa;\n        border-radius: 0.5rem;\n        padding: 1rem;\n    }\n    .popular-part-item {\n        display: flex;\n        justify-content: between;\n        align-items: center;\n        padding: 0.5rem;\n        border-radius: 0.25rem;\n        margin: 0.25rem 0;\n        cursor: pointer;\n        transition: background 0.2s ease;\n    }\n    .popular-part-item:hover {\n        background: #e9ecef;\n    }\n    .match-summary {\n        background: linear-gradient(45deg, #28a745, #20c997);\n        color: white;\n        border-radius: 0.5rem;\n        padding: 1rem;\n        margin-bottom: 1rem;\n        text-align: center;\n    }\n</style>\n{% endblock %}\n\n{% block content %}\n<div class=\"container-fluid\">\n    <!-- Search Tool Header -->\n    <div class=\"search-tool\">\n        <div class=\"row align-items-center mb-3\">\n            <div class=\"col-md-8\">\n                <h1 class=\"h3 mb-1\">\n                    <i class=\"bi bi-arrow-left-right me-2\"></i>\n                    Herramienta de Referencias Cruzadas\n                </h1>\n                <p class=\"mb-0 opacity-75\">\n                    Encuentra equivalencias entre partes OEM y aftermarket\n                </p>\n            </div>\n            <div class=\"col-md-4 text-end\">\n                <button class=\"btn btn-light\">\n                    <i class=\"bi bi-question-circle me-1\"></i>\n                    Ayuda\n                </button>\n            </div>\n        </div>\n\n        <!-- Search Form -->\n        <div class=\"search-card\">\n            <form method=\"get\" class=\"row g-3\">\n                <div class=\"col-md-6\">\n                    <label for=\"part_number\" class=\"form-label text-white\">\n                        <i class=\"bi bi-search me-1\"></i>\n                        Número de Parte\n                    </label>\n                    <input type=\"text\" \n                           class=\"form-control form-control-lg\" \n                           id=\"part_number\" \n                           name=\"part_number\" \n                           value=\"{{ search_params.part_number }}\"\n                           placeholder=\"Ingrese número de parte o VIN...\"\n                           autocomplete=\"off\">\n                </div>\n                <div class=\"col-md-4\">\n                    <label class=\"form-label text-white d-block\">\n                        <i class=\"bi bi-funnel me-1\"></i>\n                        Tipo de Búsqueda\n                    </label>\n                    <div class=\"search-type-toggle\">\n                        <button type=\"button\" \n                                class=\"search-type-btn {% if search_params.search_type == 'oem' %}active{% endif %}\" \n                                data-type=\"oem\">\n                            OEM → Aftermarket\n                        </button>\n                        <button type=\"button\" \n                                class=\"search-type-btn {% if search_params.search_type == 'aftermarket' %}active{% endif %}\" \n                                data-type=\"aftermarket\">\n                            Aftermarket → OEM\n                        </button>\n                    </div>\n                    <input type=\"hidden\" name=\"search_type\" id=\"search_type\" value=\"{{ search_params.search_type }}\">\n                </div>\n                <div class=\"col-md-2 d-flex align-items-end\">\n                    <button type=\"submit\" class=\"btn btn-light btn-lg w-100\">\n                        <i class=\"bi bi-search\"></i>\n                        Buscar\n                    </button>\n                </div>\n            </form>\n        </div>\n    </div>\n\n    <div class=\"row\">\n        <!-- Search Results -->\n        <div class=\"col-lg-9\">\n            {% if search_results %}\n                <!-- Match Summary -->\n                {% if search_results.total_matches > 0 %}\n                <div class=\"match-summary\">\n                    <div class=\"h4 mb-1\">\n                        <i class=\"bi bi-check-circle me-2\"></i>\n                        {{ search_results.total_matches }} coincidencia{{ search_results.total_matches|pluralize:\"s\" }} encontrada{{ search_results.total_matches|pluralize:\"s\" }}\n                    </div>\n                    <p class=\"mb-0\">\n                        {% if search_params.search_type == 'oem' %}\n                        Partes OEM y sus equivalencias aftermarket\n                        {% else %}\n                        Partes aftermarket y sus equivalencias OEM\n                        {% endif %}\n                    </p>\n                </div>\n                {% endif %}\n\n                <!-- OEM Parts Results -->\n                {% if search_results.oem_parts %}\n                <div class=\"mb-4\">\n                    <h5 class=\"mb-3\">\n                        <i class=\"bi bi-gear me-2 text-success\"></i>\n                        Partes OEM ({{ search_results.oem_parts|length }})\n                    </h5>\n                    {% for part in search_results.oem_parts %}\n                    <div class=\"result-card oem-result\">\n                        <div class=\"card-body\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-md-4\">\n                                    <div class=\"part-number-display\">\n                                        {{ part.part_number }}\n                                    </div>\n                                    <small class=\"text-muted d-block mt-1\">\n                                        <i class=\"bi bi-building me-1\"></i>\n                                        {{ part.oem_code.name }}\n                                    </small>\n                                </div>\n                                <div class=\"col-md-4\">\n                                    {% if part.description_es %}\n                                    <div class=\"mb-2\">\n                                        <strong>{{ part.description_es|truncatechars:60 }}</strong>\n                                    </div>\n                                    {% endif %}\n                                    <div class=\"d-flex align-items-center\">\n                                        <span class=\"badge bg-{{ part.availability_class }} me-2\">\n                                            <i class=\"{{ part.availability_icon }} me-1\"></i>\n                                            {{ part.availability_status|title }}\n                                        </span>\n                                        {% if part.group_code %}\n                                        <small class=\"text-muted\">{{ part.group_code.group_name }}</small>\n                                        {% endif %}\n                                    </div>\n                                </div>\n                                <div class=\"col-md-2 text-center\">\n                                    <div class=\"h5 mb-1\">{{ part.formatted_price }}</div>\n                                    <small class=\"text-muted\">Precio Lista</small>\n                                </div>\n                                <div class=\"col-md-2 text-end\">\n                                    <div class=\"btn-group btn-group-sm\" role=\"group\">\n                                        <button type=\"button\" class=\"btn btn-outline-primary\" title=\"Ver detalles\">\n                                            <i class=\"bi bi-eye\"></i>\n                                        </button>\n                                        <button type=\"button\" class=\"btn btn-outline-success\" title=\"Agregar\">\n                                            <i class=\"bi bi-cart-plus\"></i>\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    {% endfor %}\n                </div>\n                {% endif %}\n\n                <!-- Cross References Results -->\n                {% if search_results.cross_references %}\n                <div class=\"mb-4\">\n                    <h5 class=\"mb-3\">\n                        <i class=\"bi bi-arrow-left-right me-2 text-info\"></i>\n                        Referencias Cruzadas ({{ search_results.cross_references|length }})\n                    </h5>\n                    {% for cross_ref in search_results.cross_references %}\n                    <div class=\"result-card aftermarket-result\">\n                        <div class=\"card-body\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-md-3\">\n                                    <div class=\"mb-2\">\n                                        <strong class=\"text-primary\">OEM:</strong>\n                                        <div class=\"part-number-display\">\n                                            {{ cross_ref.oem_part_number }}\n                                        </div>\n                                        <small class=\"text-muted\">{{ cross_ref.oem_code.name }}</small>\n                                    </div>\n                                </div>\n                                <div class=\"col-md-1 text-center\">\n                                    <i class=\"bi bi-arrow-right text-muted fs-3\"></i>\n                                </div>\n                                <div class=\"col-md-3\">\n                                    <div class=\"mb-2\">\n                                        <strong class=\"text-info\">Aftermarket:</strong>\n                                        <div class=\"part-number-display\">\n                                            {{ cross_ref.aftermarket_sku|default:\"N/A\" }}\n                                        </div>\n                                        <small class=\"text-muted\">{{ cross_ref.get_equivalence_type_display|default:\"Equivalente\" }}</small>\n                                    </div>\n                                </div>\n                                <div class=\"col-md-3\">\n                                    <div class=\"mb-2\">\n                                        <small class=\"text-muted d-block\">Nivel de Confianza</small>\n                                        <div class=\"d-flex align-items-center\">\n                                            <div class=\"confidence-meter me-2\">\n                                                <div class=\"confidence-fill bg-{{ cross_ref.confidence_class }}\" \n                                                     style=\"width: {{ cross_ref.confidence_score|default:0 }}%;\"></div>\n                                            </div>\n                                            <span class=\"badge bg-{{ cross_ref.confidence_class }}\">\n                                                {{ cross_ref.confidence_percent }}\n                                            </span>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-md-2 text-end\">\n                                    <div class=\"btn-group btn-group-sm\" role=\"group\">\n                                        <button type=\"button\" class=\"btn btn-outline-info\" title=\"Ver detalles\">\n                                            <i class=\"bi bi-eye\"></i>\n                                        </button>\n                                        <button type=\"button\" class=\"btn btn-outline-success\" title=\"Usar equivalencia\">\n                                            <i class=\"bi bi-check-lg\"></i>\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            {% if cross_ref.notes %}\n                            <div class=\"row mt-2\">\n                                <div class=\"col-12\">\n                                    <div class=\"alert alert-info py-2 mb-0\">\n                                        <small>\n                                            <i class=\"bi bi-info-circle me-1\"></i>\n                                            {{ cross_ref.notes|truncatechars:100 }}\n                                        </small>\n                                    </div>\n                                </div>\n                            </div>\n                            {% endif %}\n                        </div>\n                    </div>\n                    {% endfor %}\n                </div>\n                {% endif %}\n\n                {% if search_results.total_matches == 0 %}\n                <!-- No Results -->\n                <div class=\"text-center py-5\">\n                    <i class=\"bi bi-search text-muted\" style=\"font-size: 4rem;\"></i>\n                    <h4 class=\"text-muted mt-3\">No se encontraron coincidencias</h4>\n                    <p class=\"text-muted\">\n                        No hay referencias cruzadas para \"{{ search_params.part_number }}\".\n                        <br>\n                        Intente con un número de parte diferente o verifique la ortografía.\n                    </p>\n                    <button class=\"btn btn-outline-primary mt-2\" onclick=\"document.getElementById('part_number').focus()\">\n                        <i class=\"bi bi-arrow-clockwise me-1\"></i>\n                        Intentar Nueva Búsqueda\n                    </button>\n                </div>\n                {% endif %}\n\n            {% elif search_params.part_number %}\n            <!-- Loading or Error State -->\n            <div class=\"text-center py-5\">\n                <div class=\"spinner-border text-primary\" role=\"status\">\n                    <span class=\"visually-hidden\">Buscando...</span>\n                </div>\n                <h4 class=\"text-muted mt-3\">Buscando referencias...</h4>\n                <p class=\"text-muted\">Por favor espere mientras procesamos su búsqueda.</p>\n            </div>\n\n            {% else %}\n            <!-- Initial State -->\n            <div class=\"text-center py-5\">\n                <i class=\"bi bi-arrow-left-right text-muted\" style=\"font-size: 4rem;\"></i>\n                <h4 class=\"text-muted mt-3\">Herramienta de Referencias Cruzadas</h4>\n                <p class=\"text-muted\">\n                    Ingrese un número de parte para encontrar sus equivalencias.\n                    <br>\n                    Puede buscar desde OEM hacia aftermarket o viceversa.\n                </p>\n                <div class=\"row justify-content-center mt-4\">\n                    <div class=\"col-md-8\">\n                        <div class=\"card\">\n                            <div class=\"card-body\">\n                                <h6 class=\"card-title\">\n                                    <i class=\"bi bi-lightbulb me-2 text-warning\"></i>\n                                    Consejos de Búsqueda\n                                </h6>\n                                <ul class=\"list-unstyled mb-0\">\n                                    <li class=\"mb-2\">\n                                        <i class=\"bi bi-check text-success me-2\"></i>\n                                        Use números de parte completos para mejores resultados\n                                    </li>\n                                    <li class=\"mb-2\">\n                                        <i class=\"bi bi-check text-success me-2\"></i>\n                                        Puede buscar por fragmentos de VIN\n                                    </li>\n                                    <li class=\"mb-2\">\n                                        <i class=\"bi bi-check text-success me-2\"></i>\n                                        Seleccione el tipo de búsqueda apropiado\n                                    </li>\n                                    <li>\n                                        <i class=\"bi bi-check text-success me-2\"></i>\n                                        Revise el nivel de confianza de las equivalencias\n                                    </li>\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            {% endif %}\n        </div>\n\n        <!-- Sidebar -->\n        <div class=\"col-lg-3\">\n            <!-- Popular Parts -->\n            {% if popular_parts %}\n            <div class=\"card mb-3\">\n                <div class=\"card-header\">\n                    <h6 class=\"mb-0\">\n                        <i class=\"bi bi-star me-2\"></i>\n                        Partes Populares\n                    </h6>\n                </div>\n                <div class=\"card-body p-0\">\n                    <div class=\"popular-parts\">\n                        {% for part in popular_parts %}\n                        <div class=\"popular-part-item\" \n                             onclick=\"searchPart('{{ part.part_number }}', 'oem')\">\n                            <div class=\"flex-grow-1\">\n                                <strong>{{ part.part_number }}</strong>\n                                <small class=\"text-muted d-block\">{{ part.oem_code.name }}</small>\n                            </div>\n                            <i class=\"bi bi-arrow-right text-muted\"></i>\n                        </div>\n                        {% endfor %}\n                    </div>\n                </div>\n            </div>\n            {% endif %}\n\n            <!-- Search History -->\n            <div class=\"card mb-3\">\n                <div class=\"card-header\">\n                    <h6 class=\"mb-0\">\n                        <i class=\"bi bi-clock-history me-2\"></i>\n                        Búsquedas Recientes\n                    </h6>\n                </div>\n                <div class=\"card-body\">\n                    <div class=\"text-muted text-center py-3\">\n                        <i class=\"bi bi-clock\"></i>\n                        <br>\n                        <small>No hay búsquedas recientes</small>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Quick Actions -->\n            <div class=\"card\">\n                <div class=\"card-header\">\n                    <h6 class=\"mb-0\">\n                        <i class=\"bi bi-lightning me-2\"></i>\n                        Acciones Rápidas\n                    </h6>\n                </div>\n                <div class=\"card-body\">\n                    <div class=\"d-grid gap-2\">\n                        <button class=\"btn btn-outline-primary btn-sm\">\n                            <i class=\"bi bi-box-seam me-1\"></i>\n                            Catálogo OEM\n                        </button>\n                        <button class=\"btn btn-outline-info btn-sm\">\n                            <i class=\"bi bi-building me-1\"></i>\n                            Fabricantes\n                        </button>\n                        <button class=\"btn btn-outline-success btn-sm\">\n                            <i class=\"bi bi-upload me-1\"></i>\n                            Importar Referencias\n                        </button>\n                        <button class=\"btn btn-outline-secondary btn-sm\">\n                            <i class=\"bi bi-download me-1\"></i>\n                            Exportar Resultados\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n{% endblock %}\n\n{% block extra_js %}\n<script>\ndocument.addEventListener('DOMContentLoaded', function() {\n    // Search type toggle\n    const searchTypeButtons = document.querySelectorAll('.search-type-btn');\n    const searchTypeInput = document.getElementById('search_type');\n    \n    searchTypeButtons.forEach(button => {\n        button.addEventListener('click', function() {\n            // Remove active class from all buttons\n            searchTypeButtons.forEach(btn => btn.classList.remove('active'));\n            // Add active class to clicked button\n            this.classList.add('active');\n            // Update hidden input\n            searchTypeInput.value = this.dataset.type;\n        });\n    });\n    \n    // Auto-focus on part number input\n    const partNumberInput = document.getElementById('part_number');\n    if (partNumberInput && !partNumberInput.value) {\n        partNumberInput.focus();\n    }\n    \n    // Enter key submission\n    partNumberInput.addEventListener('keypress', function(e) {\n        if (e.key === 'Enter') {\n            this.form.submit();\n        }\n    });\n    \n    // Animate confidence meters\n    document.querySelectorAll('.confidence-fill').forEach(fill => {\n        const width = fill.style.width;\n        fill.style.width = '0%';\n        setTimeout(() => {\n            fill.style.width = width;\n        }, 500);\n    });\n    \n    // Result card hover effects\n    document.querySelectorAll('.result-card').forEach(card => {\n        card.addEventListener('mouseenter', function() {\n            this.style.borderColor = '#007bff';\n        });\n        \n        card.addEventListener('mouseleave', function() {\n            this.style.borderColor = '#e0e0e0';\n        });\n    });\n});\n\n// Function to search for a specific part\nfunction searchPart(partNumber, searchType) {\n    document.getElementById('part_number').value = partNumber;\n    document.getElementById('search_type').value = searchType;\n    \n    // Update active button\n    document.querySelectorAll('.search-type-btn').forEach(btn => {\n        btn.classList.remove('active');\n        if (btn.dataset.type === searchType) {\n            btn.classList.add('active');\n        }\n    });\n    \n    // Submit form\n    document.querySelector('form').submit();\n}\n</script>\n{% endblock %}"}