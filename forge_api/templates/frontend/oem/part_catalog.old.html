{% extends 'frontend/base.html' %}\n{% load static %}\n\n{% block title %}Catálogo de Partes OEM - MovIAx{% endblock %}\n\n{% block extra_css %}\n<style>\n    .part-card {\n        transition: all 0.3s ease;\n        border: 1px solid #e0e0e0;\n        border-radius: 0.5rem;\n        margin-bottom: 1rem;\n        overflow: hidden;\n    }\n    .part-card:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        border-color: #007bff;\n    }\n    .part-header {\n        background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);\n        color: white;\n        padding: 1rem;\n    }\n    .availability-badge {\n        display: inline-flex;\n        align-items: center;\n        padding: 0.25rem 0.75rem;\n        border-radius: 1rem;\n        font-size: 0.75rem;\n        font-weight: 600;\n    }\n    .compatibility-score {\n        width: 50px;\n        height: 50px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-weight: bold;\n        color: white;\n        font-size: 0.8rem;\n    }\n    .cross-ref-item {\n        background: #f8f9fa;\n        border: 1px solid #dee2e6;\n        border-radius: 0.25rem;\n        padding: 0.5rem;\n        margin: 0.25rem 0;\n        display: flex;\n        justify-content: between;\n        align-items: center;\n    }\n    .price-display {\n        background: linear-gradient(45deg, #28a745, #20c997);\n        color: white;\n        padding: 0.5rem 1rem;\n        border-radius: 0.5rem;\n        font-weight: bold;\n        text-align: center;\n    }\n    .vin-pattern {\n        background: #e9ecef;\n        border-radius: 0.25rem;\n        padding: 0.25rem 0.5rem;\n        font-family: monospace;\n        font-size: 0.8rem;\n        margin: 0.125rem;\n        display: inline-block;\n    }\n    .search-filters {\n        background: #f8f9fa;\n        border-radius: 0.5rem;\n        padding: 1.5rem;\n        margin-bottom: 2rem;\n    }\n    .catalog-header {\n        background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);\n        color: white;\n        border-radius: 0.5rem;\n        padding: 2rem;\n        margin-bottom: 2rem;\n    }\n    .part-specs {\n        background: #f8f9fa;\n        border-radius: 0.25rem;\n        padding: 0.75rem;\n        margin: 0.5rem 0;\n    }\n</style>\n{% endblock %}\n\n{% block content %}\n<div class=\"container-fluid\">\n    <!-- Header -->\n    <div class=\"catalog-header\">\n        <div class=\"row align-items-center\">\n            <div class=\"col-md-8\">\n                <h1 class=\"h3 mb-1\">\n                    <i class=\"bi bi-box-seam me-2\"></i>\n                    Catálogo de Partes OEM\n                </h1>\n                <p class=\"mb-0 opacity-75\">\n                    Búsqueda avanzada y referencias cruzadas de partes originales\n                </p>\n            </div>\n            <div class=\"col-md-4 text-end\">\n                <div class=\"btn-group\" role=\"group\">\n                    <button class=\"btn btn-light\">\n                        <i class=\"bi bi-plus-lg me-1\"></i>\n                        Nueva Parte\n                    </button>\n                    <button class=\"btn btn-outline-light\">\n                        <i class=\"bi bi-arrow-left-right me-1\"></i>\n                        Referencias Cruzadas\n                    </button>\n                    <button class=\"btn btn-outline-light\">\n                        <i class=\"bi bi-download me-1\"></i>\n                        Exportar\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Catalog Stats -->\n    {% if catalog_stats.total > 0 %}\n    <div class=\"row mb-4\">\n        <div class=\"col-lg-3 col-md-6 mb-3\">\n            <div class=\"card border-0 shadow-sm\">\n                <div class=\"card-body text-center\">\n                    <div class=\"h2 text-primary mb-1\">{{ catalog_stats.total }}</div>\n                    <div class=\"text-muted\">Total Partes</div>\n                    <div class=\"progress mt-2\" style=\"height: 4px;\">\n                        <div class=\"progress-bar bg-primary\" style=\"width: 100%;\"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"col-lg-3 col-md-6 mb-3\">\n            <div class=\"card border-0 shadow-sm\">\n                <div class=\"card-body text-center\">\n                    <div class=\"h2 text-success mb-1\">{{ catalog_stats.in_stock }}</div>\n                    <div class=\"text-muted\">En Stock</div>\n                    <div class=\"progress mt-2\" style=\"height: 4px;\">\n                        <div class=\"progress-bar bg-success\" style=\"width: {{ catalog_stats.availability_rate }}%;\"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"col-lg-3 col-md-6 mb-3\">\n            <div class=\"card border-0 shadow-sm\">\n                <div class=\"card-body text-center\">\n                    <div class=\"h2 text-info mb-1\">{{ catalog_stats.with_cross_refs }}</div>\n                    <div class=\"text-muted\">Con Referencias</div>\n                    <div class=\"progress mt-2\" style=\"height: 4px;\">\n                        <div class=\"progress-bar bg-info\" style=\"width: {% widthratio catalog_stats.with_cross_refs catalog_stats.total 100 %}%;\"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"col-lg-3 col-md-6 mb-3\">\n            <div class=\"card border-0 shadow-sm\">\n                <div class=\"card-body text-center\">\n                    <div class=\"h2 text-warning mb-1\">{{ catalog_stats.avg_compatibility|floatformat:0 }}</div>\n                    <div class=\"text-muted\">Compatibilidad Promedio</div>\n                    <div class=\"progress mt-2\" style=\"height: 4px;\">\n                        <div class=\"progress-bar bg-warning\" style=\"width: {{ catalog_stats.avg_compatibility }}%;\"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    {% endif %}\n\n    <!-- Search and Filters -->\n    <div class=\"search-filters\">\n        <form method=\"get\" class=\"row g-3\">\n            <div class=\"col-md-4\">\n                <label for=\"search\" class=\"form-label\">\n                    <i class=\"bi bi-search me-1\"></i>\n                    Buscar Parte\n                </label>\n                <input type=\"text\" \n                       class=\"form-control\" \n                       id=\"search\" \n                       name=\"search\" \n                       value=\"{{ filters.search }}\"\n                       placeholder=\"Número de parte, descripción o VIN...\">\n            </div>\n            <div class=\"col-md-2\">\n                <label for=\"manufacturer\" class=\"form-label\">\n                    <i class=\"bi bi-building me-1\"></i>\n                    Fabricante\n                </label>\n                <select class=\"form-select\" id=\"manufacturer\" name=\"manufacturer\">\n                    <option value=\"\">Todos los Fabricantes</option>\n                    {% for manufacturer in manufacturers %}\n                    <option value=\"{{ manufacturer.brand_id }}\" \n                            {% if manufacturer.brand_id|stringformat:\"s\" == filters.manufacturer %}selected{% endif %}>\n                        {{ manufacturer.name }}\n                    </option>\n                    {% endfor %}\n                </select>\n            </div>\n            <div class=\"col-md-2\">\n                <label for=\"category\" class=\"form-label\">\n                    <i class=\"bi bi-tags me-1\"></i>\n                    Categoría\n                </label>\n                <select class=\"form-select\" id=\"category\" name=\"category\">\n                    {% for option in category_options %}\n                    <option value=\"{{ option.value }}\" \n                            {% if option.value == filters.category %}selected{% endif %}>\n                        {{ option.label }}\n                    </option>\n                    {% endfor %}\n                </select>\n            </div>\n            <div class=\"col-md-3\">\n                <label for=\"availability\" class=\"form-label\">\n                    <i class=\"bi bi-check-circle me-1\"></i>\n                    Disponibilidad\n                </label>\n                <select class=\"form-select\" id=\"availability\" name=\"availability\">\n                    {% for option in availability_options %}\n                    <option value=\"{{ option.value }}\" \n                            {% if option.value == filters.availability %}selected{% endif %}>\n                        {{ option.label }}\n                    </option>\n                    {% endfor %}\n                </select>\n            </div>\n            <div class=\"col-md-1 d-flex align-items-end\">\n                <button type=\"submit\" class=\"btn btn-primary w-100\">\n                    <i class=\"bi bi-funnel\"></i>\n                </button>\n            </div>\n        </form>\n    </div>\n\n    <!-- Parts List -->\n    {% if parts %}\n    <div class=\"row\">\n        {% for part in parts %}\n        <div class=\"col-xl-6 mb-4\">\n            <div class=\"part-card h-100\">\n                <!-- Part Header -->\n                <div class=\"part-header\">\n                    <div class=\"d-flex justify-content-between align-items-start\">\n                        <div class=\"flex-grow-1\">\n                            <div class=\"d-flex align-items-center mb-2\">\n                                <i class=\"{{ part.availability_icon }} me-2 fs-4\"></i>\n                                <div>\n                                    <h5 class=\"mb-0\">{{ part.part_number }}</h5>\n                                    <small class=\"opacity-75\">{{ part.oem_code.name }}</small>\n                                </div>\n                            </div>\n                            \n                            <div class=\"d-flex align-items-center\">\n                                <span class=\"availability-badge bg-{{ part.availability_class }} me-2\">\n                                    <i class=\"{{ part.availability_icon }} me-1\"></i>\n                                    {{ part.availability_status|title }}\n                                </span>\n                                {% if part.part_number_type %}\n                                <span class=\"badge bg-light text-dark\">\n                                    {{ part.get_part_number_type_display }}\n                                </span>\n                                {% endif %}\n                            </div>\n                        </div>\n                        \n                        <div class=\"text-end\">\n                            <!-- Compatibility Score -->\n                            <div class=\"compatibility-score bg-{{ part.compatibility_class }}\">\n                                {{ part.compatibility_score }}\n                            </div>\n                            <small class=\"opacity-75 d-block mt-1\">Compatibilidad</small>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Part Body -->\n                <div class=\"card-body\">\n                    <!-- Description -->\n                    {% if part.description_es %}\n                    <div class=\"mb-3\">\n                        <small class=\"text-muted d-block mb-1\">\n                            <i class=\"bi bi-file-text me-1\"></i>\n                            Descripción\n                        </small>\n                        <p class=\"mb-0\">{{ part.description_es|truncatechars:100 }}</p>\n                    </div>\n                    {% endif %}\n\n                    <!-- Specifications -->\n                    <div class=\"part-specs\">\n                        <div class=\"row g-2\">\n                            {% if part.weight_kg %}\n                            <div class=\"col-6\">\n                                <small class=\"text-muted d-block\">Peso</small>\n                                <div class=\"small\">{{ part.weight_kg }} kg</div>\n                            </div>\n                            {% endif %}\n                            {% if part.dimensions %}\n                            <div class=\"col-6\">\n                                <small class=\"text-muted d-block\">Dimensiones</small>\n                                <div class=\"small\">{{ part.dimensions }}</div>\n                            </div>\n                            {% endif %}\n                            {% if part.material %}\n                            <div class=\"col-6\">\n                                <small class=\"text-muted d-block\">Material</small>\n                                <div class=\"small\">{{ part.material }}</div>\n                            </div>\n                            {% endif %}\n                            {% if part.oem_lead_time_days %}\n                            <div class=\"col-6\">\n                                <small class=\"text-muted d-block\">Tiempo de Entrega</small>\n                                <div class=\"small\">{{ part.oem_lead_time_days }} días</div>\n                            </div>\n                            {% endif %}\n                        </div>\n                    </div>\n\n                    <!-- VIN Patterns -->\n                    {% if part.vin_patterns %}\n                    <div class=\"mb-3\">\n                        <small class=\"text-muted d-block mb-2\">\n                            <i class=\"bi bi-qr-code me-1\"></i>\n                            Patrones VIN\n                        </small>\n                        <div>\n                            {% for pattern in part.vin_patterns %}\n                            <span class=\"vin-pattern\">{{ pattern }}</span>\n                            {% endfor %}\n                        </div>\n                    </div>\n                    {% endif %}\n\n                    <!-- Cross References -->\n                    {% if part.cross_references %}\n                    <div class=\"mb-3\">\n                        <small class=\"text-muted d-block mb-2\">\n                            <i class=\"bi bi-arrow-left-right me-1\"></i>\n                            Referencias Cruzadas ({{ part.cross_ref_count }})\n                        </small>\n                        <div>\n                            {% for cross_ref in part.cross_references %}\n                            <div class=\"cross-ref-item\">\n                                <div class=\"flex-grow-1\">\n                                    <strong>{{ cross_ref.aftermarket_sku|default:\"N/A\" }}</strong>\n                                    <small class=\"text-muted d-block\">{{ cross_ref.get_equivalence_type_display|default:\"Equivalente\" }}</small>\n                                </div>\n                                <div class=\"text-end\">\n                                    <span class=\"badge bg-{{ cross_ref.confidence_class }}\">\n                                        {{ cross_ref.confidence_score|default:0 }}%\n                                    </span>\n                                </div>\n                            </div>\n                            {% endfor %}\n                            {% if part.cross_ref_count > 5 %}\n                            <div class=\"text-center mt-2\">\n                                <button class=\"btn btn-sm btn-outline-primary\">\n                                    Ver todas ({{ part.cross_ref_count }})\n                                </button>\n                            </div>\n                            {% endif %}\n                        </div>\n                    </div>\n                    {% endif %}\n\n                    <!-- Pricing -->\n                    <div class=\"mb-3\">\n                        <div class=\"d-flex justify-content-between align-items-center\">\n                            <small class=\"text-muted\">\n                                <i class=\"bi bi-currency-dollar me-1\"></i>\n                                Precio de Lista\n                            </small>\n                            <div class=\"price-display\">\n                                {{ part.formatted_price }}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Part Footer -->\n                <div class=\"card-footer bg-light\">\n                    <div class=\"d-flex justify-content-between align-items-center\">\n                        <small class=\"text-muted\">\n                            <i class=\"bi bi-calendar me-1\"></i>\n                            Actualizado {{ part.updated_at|date:\"d/m/Y\"|default:\"N/A\" }}\n                        </small>\n                        <div class=\"btn-group btn-group-sm\" role=\"group\">\n                            <button type=\"button\" class=\"btn btn-outline-primary\" title=\"Ver detalles\">\n                                <i class=\"bi bi-eye\"></i>\n                            </button>\n                            <button type=\"button\" class=\"btn btn-outline-info\" title=\"Referencias cruzadas\">\n                                <i class=\"bi bi-arrow-left-right\"></i>\n                            </button>\n                            <button type=\"button\" class=\"btn btn-outline-success\" title=\"Agregar a cotización\">\n                                <i class=\"bi bi-cart-plus\"></i>\n                            </button>\n                            <button type=\"button\" class=\"btn btn-outline-secondary\" title=\"Comparar\">\n                                <i class=\"bi bi-check2-square\"></i>\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        {% endfor %}\n    </div>\n\n    <!-- Pagination -->\n    {% if pagination.total_pages > 1 %}\n    <div class=\"row mt-4\">\n        <div class=\"col-12\">\n            <nav aria-label=\"Paginación de partes\">\n                <ul class=\"pagination justify-content-center\">\n                    {% if pagination.has_previous %}\n                    <li class=\"page-item\">\n                        <a class=\"page-link\" href=\"?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page=1\">\n                            <i class=\"bi bi-chevron-double-left\"></i>\n                        </a>\n                    </li>\n                    <li class=\"page-item\">\n                        <a class=\"page-link\" href=\"?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ pagination.current_page|add:'-1' }}\">\n                            <i class=\"bi bi-chevron-left\"></i>\n                        </a>\n                    </li>\n                    {% endif %}\n                    \n                    {% for page_num in pagination.page_range %}\n                    <li class=\"page-item {% if page_num == pagination.current_page %}active{% endif %}\">\n                        <a class=\"page-link\" href=\"?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_num }}\">\n                            {{ page_num }}\n                        </a>\n                    </li>\n                    {% endfor %}\n                    \n                    {% if pagination.has_next %}\n                    <li class=\"page-item\">\n                        <a class=\"page-link\" href=\"?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ pagination.current_page|add:'1' }}\">\n                            <i class=\"bi bi-chevron-right\"></i>\n                        </a>\n                    </li>\n                    <li class=\"page-item\">\n                        <a class=\"page-link\" href=\"?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ pagination.total_pages }}\">\n                            <i class=\"bi bi-chevron-double-right\"></i>\n                        </a>\n                    </li>\n                    {% endif %}\n                </ul>\n            </nav>\n        </div>\n    </div>\n    {% endif %}\n\n    {% else %}\n    <!-- Empty State -->\n    <div class=\"text-center py-5\">\n        <i class=\"bi bi-box-seam text-muted\" style=\"font-size: 4rem;\"></i>\n        <h4 class=\"text-muted mt-3\">No se encontraron partes</h4>\n        <p class=\"text-muted\">\n            {% if filters.search or filters.manufacturer or filters.category or filters.availability %}\n            No hay partes que coincidan con los filtros aplicados.\n            <br>\n            <a href=\"{% url 'frontend:oem_part_catalog' %}\" class=\"btn btn-outline-primary mt-2\">\n                <i class=\"bi bi-arrow-clockwise me-1\"></i>\n                Limpiar Filtros\n            </a>\n            {% else %}\n            El catálogo de partes OEM está vacío.\n            <br>\n            <button class=\"btn btn-primary mt-2\">\n                <i class=\"bi bi-plus-lg me-1\"></i>\n                Importar Catálogo\n            </button>\n            {% endif %}\n        </p>\n    </div>\n    {% endif %}\n</div>\n{% endblock %}\n\n{% block extra_js %}\n<script>\ndocument.addEventListener('DOMContentLoaded', function() {\n    // Auto-submit form on filter change\n    const filterSelects = document.querySelectorAll('#manufacturer, #category, #availability');\n    filterSelects.forEach(select => {\n        select.addEventListener('change', function() {\n            this.form.submit();\n        });\n    });\n    \n    // Search input debounce\n    const searchInput = document.getElementById('search');\n    let searchTimeout;\n    searchInput.addEventListener('input', function() {\n        clearTimeout(searchTimeout);\n        searchTimeout = setTimeout(() => {\n            this.form.submit();\n        }, 500);\n    });\n    \n    // Part card hover effects\n    document.querySelectorAll('.part-card').forEach(card => {\n        card.addEventListener('mouseenter', function() {\n            this.style.borderColor = '#007bff';\n        });\n        \n        card.addEventListener('mouseleave', function() {\n            this.style.borderColor = '#e0e0e0';\n        });\n    });\n    \n    // Compatibility score animations\n    document.querySelectorAll('.compatibility-score').forEach(score => {\n        const value = parseInt(score.textContent);\n        score.style.transform = 'scale(0)';\n        setTimeout(() => {\n            score.style.transform = 'scale(1)';\n        }, 100);\n    });\n    \n    // Cross-reference item interactions\n    document.querySelectorAll('.cross-ref-item').forEach(item => {\n        item.addEventListener('click', function() {\n            // Highlight selected cross-reference\n            document.querySelectorAll('.cross-ref-item').forEach(i => {\n                i.classList.remove('border-primary');\n            });\n            this.classList.add('border-primary');\n        });\n    });\n});\n</script>\n{% endblock %}"}